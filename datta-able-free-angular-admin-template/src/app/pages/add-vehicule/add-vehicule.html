<section class="vehicle-page" @pageFadeIn>
  <div class="vehicle-page__container" @sectionStagger>
    <header class="vehicle-page__header vehicle-section">
      <div class="vehicle-page__headline">
        <p class="vehicle-page__eyebrow">Fleet Management</p>
        <h1>Ajouter vehicule</h1>
        <p class="vehicle-page__subtitle">Creez un dossier vehicule complet avec donnees techniques et documents obligatoires.</p>
      </div>
      <div class="vehicle-page__badge">
        <i class="feather icon-shield"></i>
        <span>Conforme entreprise</span>
      </div>
    </header>

    <form [formGroup]="vehiculeForm" (ngSubmit)="onSubmit()" novalidate>
      <article class="vehicle-card vehicle-section">
        <button type="button" class="vehicle-card__header" (click)="toggleSection('vehicleInfo')">
          <div class="vehicle-card__title-wrap">
            <span class="vehicle-card__icon"><i class="feather icon-truck"></i></span>
            <div>
              <h2>Vehicle Information</h2>
              <p>Identifiants de base du vehicule.</p>
            </div>
          </div>
          <i class="feather" [ngClass]="isSectionOpen('vehicleInfo') ? 'icon-chevron-up' : 'icon-chevron-down'"></i>
        </button>

        <div class="vehicle-card__body" [@sectionExpand]="isSectionOpen('vehicleInfo') ? 'open' : 'closed'">
          <div class="row g-3">
            <div class="col-12 col-md-6 col-lg-4">
              <app-vehicle-form-field
                forId="vehicule-matricule"
                label="Matricule"
                [required]="true"
                [control]="vehiculeForm.controls.matricule"
                customError="La matricule est obligatoire."
              >
                <input id="vehicule-matricule" class="vehicle-control" type="text" formControlName="matricule" placeholder=" " autocomplete="off" />
              </app-vehicle-form-field>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
              <app-vehicle-form-field
                forId="vehicule-marque"
                label="Marque"
                [required]="true"
                [control]="vehiculeForm.controls.marque"
                customError="La marque est obligatoire."
              >
                <input id="vehicule-marque" class="vehicle-control" type="text" formControlName="marque" placeholder=" " autocomplete="off" />
              </app-vehicle-form-field>
            </div>

            <div class="col-12 col-md-6 col-lg-4">
              <app-vehicle-form-field
                forId="vehicule-modele"
                label="Modele"
                [required]="true"
                [control]="vehiculeForm.controls.modele"
                customError="Le modele est obligatoire."
              >
                <input id="vehicule-modele" class="vehicle-control" type="text" formControlName="modele" placeholder=" " autocomplete="off" />
              </app-vehicle-form-field>
            </div>
          </div>
        </div>
      </article>

      <article class="vehicle-card vehicle-section">
        <button type="button" class="vehicle-card__header" (click)="toggleSection('technicalDetails')">
          <div class="vehicle-card__title-wrap">
            <span class="vehicle-card__icon"><i class="feather icon-settings"></i></span>
            <div>
              <h2>Technical Details</h2>
              <p>Specifications techniques et configuration.</p>
            </div>
          </div>
          <i class="feather" [ngClass]="isSectionOpen('technicalDetails') ? 'icon-chevron-up' : 'icon-chevron-down'"></i>
        </button>

        <div class="vehicle-card__body" [@sectionExpand]="isSectionOpen('technicalDetails') ? 'open' : 'closed'">
          <div class="row g-3">
            <div class="col-12 col-md-6 col-lg-3">
              <app-vehicle-form-field
                forId="vehicule-puissance"
                label="Puissance (CV)"
                [required]="true"
                [control]="vehiculeForm.controls.puissance"
                customError="La puissance doit etre superieure a 0."
              >
                <input id="vehicule-puissance" class="vehicle-control" type="number" formControlName="puissance" placeholder=" " min="1" />
              </app-vehicle-form-field>
            </div>

            <div class="col-12 col-md-6 col-lg-3">
              <app-vehicle-form-field forId="vehicule-carburant" label="Carburant" [required]="true" [control]="vehiculeForm.controls.carburant">
                <select id="vehicule-carburant" class="vehicle-control vehicle-control--select" formControlName="carburant">
                  <option value="Essence">Essence</option>
                  <option value="Diesel">Diesel</option>
                </select>
              </app-vehicle-form-field>
            </div>

            <div class="col-12 col-md-6 col-lg-3">
              <app-vehicle-form-field
                forId="vehicule-places"
                label="Places"
                [required]="true"
                [control]="vehiculeForm.controls.places"
                customError="Le nombre de places doit etre superieur a 0."
              >
                <input id="vehicule-places" class="vehicle-control" type="number" formControlName="places" placeholder=" " min="1" />
              </app-vehicle-form-field>
            </div>

            <div class="col-12 col-md-6 col-lg-3">
              <app-vehicle-form-field
                forId="vehicule-annee"
                label="Annee"
                [required]="true"
                [control]="vehiculeForm.controls.annee"
                customError="Veuillez saisir une annee valide."
              >
                <input id="vehicule-annee" class="vehicle-control" type="number" formControlName="annee" placeholder=" " min="1900" />
              </app-vehicle-form-field>
            </div>
          </div>
        </div>
      </article>

      <article class="vehicle-card vehicle-section">
        <button type="button" class="vehicle-card__header" (click)="toggleSection('documentsUpload')">
          <div class="vehicle-card__title-wrap">
            <span class="vehicle-card__icon"><i class="feather icon-file-text"></i></span>
            <div>
              <h2>Documents Upload</h2>
              <p>Ajoutez les pieces justificatives du vehicule.</p>
            </div>
          </div>
          <i class="feather" [ngClass]="isSectionOpen('documentsUpload') ? 'icon-chevron-up' : 'icon-chevron-down'"></i>
        </button>

        <div class="vehicle-card__body" [@sectionExpand]="isSectionOpen('documentsUpload') ? 'open' : 'closed'">
          <div class="row g-3">
            @for (document of documentConfigs; track trackDocument($index, document)) {
              <div class="col-12 col-md-6">
                <app-vehicle-document-upload
                  [title]="document.title"
                  [description]="document.description"
                  [accept]="document.accept"
                  [required]="document.required"
                  [invalid]="isDocumentInvalid(document.key)"
                  [file]="files[document.key] ?? null"
                  (fileChange)="onDocumentChanged(document.key, $event)"
                />
              </div>
            }
          </div>
        </div>
      </article>

      <section class="vehicle-actions vehicle-card vehicle-section">
        <div class="vehicle-actions__summary">
          <h3>Pret a enregistrer ce vehicule ?</h3>
          <p>Verifiez les informations et confirmez pour enregistrer le dossier.</p>
        </div>

        <div class="vehicle-actions__buttons">
          <button type="button" class="btn btn-outline-secondary vehicle-btn" (click)="onAnnuler()" [disabled]="isSubmitting()">
            <i class="feather icon-arrow-left"></i>
            Retour
          </button>
          <button type="button" class="btn btn-outline-dark vehicle-btn" (click)="onResetForm()" [disabled]="isSubmitting()">
            <i class="feather icon-refresh-cw"></i>
            Reinitialiser
          </button>
          <button type="submit" class="btn btn-primary vehicle-btn vehicle-btn--primary" [disabled]="isSubmitting()">
            @if (isSubmitting()) {
              <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
              Enregistrement...
            } @else {
              <i class="feather icon-check-circle"></i>
              Valider l'enregistrement
            }
          </button>
        </div>
      </section>
    </form>
  </div>
</section>
